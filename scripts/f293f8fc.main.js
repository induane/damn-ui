!function(){"use strict";var a="http://damn.csproject.org:8081",b={},c=function(c){if(0==!c.indexOf("http")&&(c=a+c),b[c])return b[c];var d=$.ajax({url:c,method:"GET",dataType:"json"});return d.fail(function(a,b,c){console.log(a,b,c)}).done(function(){delete b[c]}),d};window.Request=c;var d=function(b){return 0==!b.indexOf("http")&&(b=a+b),$.ajax({url:b,method:"OPTIONS",dataType:"json"}).fail(function(a,b,c){console.log(a,b,c)}).done(function(){console.log("RequestOPTIONS::done: "+b)})};window.RequestOPTIONS=d;var e=function(c,d){return 0==!c.indexOf("http")&&(c=a+c),b[c]?b[c]:$.ajax({url:c,method:"POST",dataType:"json",data:d}).fail(function(a,b,c){console.log(a,b,c)}).done(function(){delete b[c]})};window.RequestPOST=e}();var SelectableListMixin={propTypes:{state:React.PropTypes.array},getInitialState:function(){return{data:{results:[]}}},getActiveObject:function(a,b){return a.results[b]},handleSelected:function(a){this.state.selected=a,this.state.active=this.getActiveObject(this.state.data,this.state.selected),this.setState(this.state)},componentWillMount:function(){this.props.context&&(console.log("SelectableListMixin::componentWillMount: "+this.props.context),this.state.selected=this.props.context[0],this.setState(this.state))},componentWillUpdate:function(a,b){this.state.selected&&(console.log("SelectableListMixin::componentWillUpdate: "+b.selected),b.active=this.getActiveObject(b.data,b.selected))}},AsyncListMixin={propTypes:{url:function(a,b,c){if("function"!=typeof a[b].then&&"string"!=typeof a[b])throw new Error("Invariant Violation: Required prop `"+b+"` was not a Promise or a string in `"+c+"`")}},_processURL:function(a){return"function"==typeof this.processURL?this.processURL(a):a},loadData:function(a){var b=this;$.when(a).done(function(a){var c=Request(b._processURL(a));c.done(function(a){b.state.data=a,b.setState(b.state)})})},componentWillMount:function(){this.loadData(this.props.url)},componentWillReceiveProps:function(a){this.loadData(a.url)}},List=React.createClass({displayName:"List",mixins:[SelectableListMixin,AsyncListMixin],propTypes:jQuery.extend({type:React.PropTypes.func.isRequired,pathToId:React.PropTypes.string},AsyncListMixin.propTypes,SelectableListMixin.propTypes),render:function(){var a=this.props.pathToId||"id";return React.DOM.ul(null,this.state.data.results.map(function(b,c){var d=this.handleSelected.bind(this,c);return this.props.type({key:b[a]+"-"+c,data:b,onClick:d,selected:this.state.selected==c})},this))}}),FieldChoices=React.createClass({displayName:"FieldChoices",propTypes:{options:React.PropTypes.array.isRequired},render:function(){return this.transferPropsTo(React.DOM.select(null,!this.props.value&&this.props.required?React.DOM.option(null,"Please select an option"):"",$.map(this.props.options,function(a,b){return React.DOM.option({key:b,value:a.url},a.name)})))}}),Field=React.createClass({displayName:"Field",propTypes:{name:React.PropTypes.string.isRequired,type:React.PropTypes.object.isRequired,error:React.PropTypes.array},getInitialState:function(){return{value:this.props.type.instance_value}},handleChange:function(a){this.setState({value:a.target.value})},render:function(){var a="date"==this.props.type.type?"date":"text",b=this.state.value,c="field";return this.props.error&&(c+=" error"),this.transferPropsTo(React.DOM.div({className:c},React.DOM.label({htmlFor:"widget"},this.props.name),this.props.type.options?FieldChoices({required:this.props.type.required,onChange:this.handleChange,value:b,options:this.props.type.options}):"description"!=this.props.name?React.DOM.input({onChange:this.handleChange,value:b,type:a}):React.DOM.textarea({rows:"4",onChange:this.handleChange,value:b,type:a}),React.DOM.span(null,this.props.type.required?"*":" "),React.DOM.div(null,this.props.error?this.props.error[0]:"")))}}),Editor=React.createClass({displayName:"Editor",propTypes:jQuery.extend({url:React.PropTypes.string.isRequired,onSuccessfullSave:React.PropTypes.func},{}),getInitialState:function(){return{data:{actions:{POST:{}}},errors:{}}},loadOptions:function(a){var b,c=this,d=RequestOPTIONS(a);c._isInstance(a)&&(console.log("Editor::loadOptions INSTANCE"),b=Request(a)),$.when(d,b).done(function(a,b){c.state.data=a[0],b&&(c.state.instance=b[0]),c.setState(c.state)})},_isInstance:function(a){var b=/(.+?)\/\d+\/$/;return b.test(a)},_getFields:function(){var a=this.state.data.actions.PUT;return a||(a=this.state.data.actions.POST),a},getFields:function(){var a={},b=this;return $.map(this._getFields(),function(c,d){0==c.read_only&&(a[d]=c,a[d].options=b.getOptions(d),b.state.instance&&(a[d].instance_value=b.state.instance[d]))},this),a},getOptions:function(a){var b=this._getFields()[a];if("field"==b.type&&this.state.data.options&&this.state.data.options[a]){var c=this.state.data.options[a].slice(0);return 0==b.required&&c.unshift({name:"-----"}),c}return null},componentWillMount:function(){this.loadOptions(this.props.url)},componentWillReceiveProps:function(a){this.loadOptions(a.url)},handleClick:function(){var a=this,b={};$.map(this.refs,function(a,c){b[c]=a.state.value}),this._isInstance(this.props.url)&&(b._method="PUT"),console.log(b);var c=RequestPOST(this.props.url,b);c.fail(function(b){console.log(b.responseJSON),a.setState({errors:b.responseJSON})}),c.done(function(b){a.props.onSuccessfullSave&&a.props.onSuccessfullSave(b)})},componentDidUpdate:function(){var a=$(this.getDOMNode()).find("select");console.log("----componentDidUpdate----------------------"),console.log(a),console.log(a.length),console.log("--------------------------"),a.chosen()},render:function(){return console.log(this.props.url),console.log(this.state.data.actions.PUT),React.DOM.form(null,$.map(this.getFields(),function(a,b){return Field({ref:b,key:b,name:b,type:a,error:this.state.errors[b]})}.bind(this),this),React.DOM.button({type:"submit",onClick:this.handleClick},React.DOM.i({className:"fa fa-floppy-o"}),"Save"))}}),EditorControl=React.createClass({displayName:"EditorControl",getInitialState:function(){return{editing:!1}},onClick:function(a){this.setState({editing:!this.state.editing}),a.preventDefault()},onSuccessfullSave:function(a){this.setState({editing:!1}),this.props.parent.props.data=a,this.props.parent.forceUpdate()},render:function(){return this.transferPropsTo(React.DOM.div({className:"editorControl"},React.DOM.a({onClick:this.onClick,href:""},React.DOM.i({className:"fa fa-pencil-square-o"})),this.state.editing?React.DOM.div({className:"modal"},React.DOM.div({className:"close",onClick:this.onClick}),React.DOM.h1(null,"Editing ",this.props.object_url),Editor({onSuccessfullSave:this.onSuccessfullSave,url:this.props.object_url})):""))}});!function(){"use strict";var a=React.createClass({displayName:"FilteredListSearch",handleSubmit:function(){var a=this.refs.text.getDOMNode().value.trim();return this.props.onSearch({text:a}),!1},getInitialState:function(){return{description:""}},render:function(){if(this.props.search.searches){var a=this.props.search.searches.join(" ");this.state.description="Searches "+a}return React.DOM.form({className:"filteredListSearchForm",onSubmit:this.handleSubmit,title:this.state.description},React.DOM.input({type:"text",placeholder:"Search...",ref:"text"}),React.DOM.input({type:"submit",value:"Search"}))}}),b=React.createClass({displayName:"FilteredListOrder",handleClick:function(a){console.log(a);var b=$(a.target).attr("value");return console.log(b),this.props.onOrder({field:b}),!1},render:function(){return React.DOM.ul({onClick:this.handleClick},this.props.order.choices.map(function(a){return React.DOM.li({key:a[0],value:a[0]},a[1])}))}}),c=React.createClass({displayName:"FilteredListPaginator",handlePrevious:function(){return this.props.onNavigate({url:this.props.data.previous}),!1},handleNext:function(){return this.props.onNavigate({url:this.props.data.next}),!1},render:function(){return React.DOM.div(null,React.DOM.span({ref:"previous",onClick:this.handlePrevious},"Previous"),React.DOM.span({ref:"next",onClick:this.handleNext},"Next"))}}),d=React.createClass({displayName:"FilteredList",mixins:[SelectableListMixin,AsyncListMixin],propTypes:jQuery.extend({type:React.PropTypes.func.isRequired},AsyncListMixin.propTypes,SelectableListMixin.propTypes),getInitialState:function(){return{ordering:{choices:[]},search:{}}},processURL:function(a){console.log("FilteredList::processURL "+this.state.searching),console.log("FilteredList::processURL "+this.state.order_field);var b="";return this.state.search.search_by_field&&this.state.searching&&(b+="&"+this.state.search.search_by_field+"="+this.state.searching),this.state.ordering.order_by_field&&this.state.order_field&&(b+="&"+this.state.ordering.order_by_field+"="+this.state.order_field),this.state.navigate?this.state.navigating+"?"+b:a+"?"+b},handleonSearch:function(a){this.state.searching=a.text,this.loadData(this.props.url)},handleonOrder:function(a){this.state.order_field=a.field,this.loadData(this.props.url)},handleonNavigate:function(a){this.state.navigate=a.url,this.loadData(this.props.url)},loadOptions:function(a){var b=this,c=RequestOPTIONS(a);c.done(function(a){console.log(a),b.state.ordering=a.ordering,b.state.search=a.search,b.state.name=a.name,b.setState(b.state)})},componentWillMount:function(){var a=this;this.props.url.done(function(b){a.loadOptions(b)})},componentWillReceiveProps:function(a){console.log("FilteredList::componentWillReceiveProps");var b=this;this.props.url.done(function(a){b.loadOptions(a)}),this.loadData(a.url)},render:function(){return React.DOM.div({className:"active"},React.DOM.div({className:"workspace-list"},React.DOM.h3(null,this.state.name),a({search:this.state.search,onSearch:this.handleonSearch}),b({order:this.state.ordering,onOrder:this.handleonOrder}),c({data:this.state.data,onNavigate:this.handleonNavigate}),React.DOM.ul(null,this.state.data.results.map(function(a,b){var c=this.handleSelected.bind(this,b);return this.props.type({key:a.id,data:a,onClick:c,selected:this.state.selected==b})},this))),React.DOM.div({className:"workspace-detail"},this.state.active?this.props.detailtype({key:this.state.active.id,data:this.state.active,context:this.props.context.slice(1)}):""))}});window.FilteredList=d}(),function(){"use strict";function a(a){return"object"==typeof a?Object.keys(a).map(function(b){return a[b]?b:""}).join(" "):Array.prototype.join.call(arguments," ")}var b=React.createClass({displayName:"ProfilePic",render:function(){return React.DOM.img({src:"http://placekitten.com/32/32?username="+this.props.username})}});window.ProfilePic=b;var c=React.createClass({displayName:"Notification",render:function(){var c=a,d=c({notification:!0,"notification-active":this.props.selected,"notification-read":this.props.read});return this.transferPropsTo(React.DOM.li({className:d,"data-id":this.props.data.id},React.DOM.div({className:"notification-user"},b({user:this.props.data.actor,username:this.props.data.actor_descr}),React.DOM.div({className:"notification-summary"},React.DOM.div(null,React.DOM.a({href:this.props.data.actor},this.props.data.actor_descr)," "+this.props.data.verb+" ",React.DOM.a({href:this.props.data.action_object},this.props.data.action_object_descr)),React.DOM.div(null,this.props.data.timesince)))))}}),d=React.createClass({displayName:"NotificationStream",loadFromServer:function(){var a=this,b=Request(this.props.url);b.done(function(b){a.state.data=b,a.setState(a.state)})},getInitialState:function(){return{data:{results:[]},read:{}}},componentWillMount:function(){this.loadFromServer(),this.interval=setInterval(this.loadFromServer,this.props.pollInterval)},componentWillUnmount:function(){console.log("NotificationStream::componentWillUnmount"),console.log(this.interval),clearInterval(this.interval)},handleonNavigate:function(a){var b=this;b.state.active=a,b.setState(b.state)},handleSelected:function(a){console.log("Selected "),console.log(a),this.state.selected=a,this.state.active=this.state.data.results[this.state.selected],this.state.read[this.state.selected]=!0,this.setState(this.state)},render:function(){return React.DOM.div({className:"active"},React.DOM.ul({className:"workspace-list"},this.state.data.results.map(function(a,b){var d=this.handleSelected.bind(this,b);return c({onClick:d,key:a.id,data:a,selected:this.state.selected===b,read:this.state.read[b]})},this)),React.DOM.div({className:"workspace-detail"},this.state.active?this.state.active.description:""))}});window.NotificationStream=d}(),function(){"use strict";var a=$.cookie("damntoken");$.ajaxSetup({cache:!1,headers:a?{Authorization:"Token "+a}:{}});var b,c=$.Deferred(),d=React.createClass({displayName:"UserMenu",getInitialState:function(){return{username:"Loading...",avatar_src:null,loggedin:!1}},loadFromServer:function(){var a=this,d=Request("/user/");d.done(function(d){b=a.state.username=d.username,a.state.loggedin=!0,a.state.url=d.url,a.state.id=d.id,a.state.avatar_src="http://placekitten.com/32/32",a.setState(a.state),c.resolve(d.url)}),d.fail(function(){a.state=a.getInitialState(),b=a.state.username="Please login.",a.setState(a.state),c.resolve(null)})},componentWillMount:function(){this.loadFromServer()},handleLogin:function(){var a=this,b=this.refs.login.getDOMNode().value,d=this.refs.password.getDOMNode().value;console.log(b+":"+d),c=$.Deferred();var e={};e.username=b,e.password=d;var f=RequestPOST("/api-token-auth/",e);f.done(function(b){console.log(b),$.cookie("damntoken",b.token),$.ajaxSetup({headers:{Authorization:"Token "+b.token}}),a.loadFromServer()})},render:function(){return React.DOM.li({className:"user_button","data-url":this.state.url,"data-id":this.state.id},React.DOM.a({href:"#"},React.DOM.span(null,this.state.username),React.DOM.img({src:this.state.avatar_src})),this.state.loggedin?"":React.DOM.div({className:"modal"},React.DOM.h1(null,"Login"),React.DOM.form(null,React.DOM.div({className:"field",name:"Login"},React.DOM.label(null,"Login"),React.DOM.input({ref:"login",type:"text",defaultValue:"admin"})),React.DOM.div({className:"field",name:"Login"},React.DOM.label(null,"Password"),React.DOM.input({ref:"password",type:"password",defaultValue:"admin"})),React.DOM.button({onClick:this.handleLogin,type:"submit"},"Login"))))}});window.UserMenu=d,window.renderUserMenu=function(){React.renderComponent(d(null),$("#user")[0])},window.get_user_url_promise=function(a){var b=$.Deferred();return c.promise().done(function(c){console.log("USER_URL.promise() "+c+a),b.resolve(c+a)}),b.promise()},window.get_user_name=function(){return b}}();var TabsSwitcher=React.createClass({displayName:"TabsSwitcher",getDefaultProps:function(){return{tabs:[{title:"first",content:"Content 1"},{title:"second",content:"Content 2"}],active:0}},getInitialState:function(){return{active:this.props.active?this.props.active:0}},componentWillReceiveProps:function(a){this.state.active=a.active?a.active:0,this.setState(this.state)},render:function(){return React.DOM.div({className:"tabsSwitcher"},TabsPane({items:this.props.tabs,active:this.state.active,onTabClick:this.handleTabClick}),TabsContent({items:this.props.tabs,active:this.state.active}))},handleTabClick:function(a){this.setState({active:a})}}),TabsPane=React.createClass({displayName:"TabsPane",render:function(){var a=this.props.active,b=this.props.items.map(function(b,c){return React.DOM.a({key:c,href:"#",className:"tab "+(a==c?"tab_selected":""),onClick:this.onClick.bind(this,c)},b.title)}.bind(this));return React.DOM.div({className:"tabsSwitcher-header"},b)},onClick:function(a,b){b.preventDefault(),this.props.onTabClick(a)}}),TabsContent=React.createClass({displayName:"TabsContent",render:function(){var a=this.props.active,b=this.props.items.map(function(b,c){return React.DOM.div({key:c,className:"tabs-panel "+(a==c?"tabs-panel_selected":"")},b.content)});return React.DOM.div({className:"tabsSwitcher-content"},b)}}),CommentBox=React.createClass({displayName:"CommentBox",loadCommentsFromServer:function(){$.ajax({url:this.props.url,dataType:"json",success:function(a){this.setState({data:a})}.bind(this)})},handleCommentSubmit:function(a){var b=this.state.data.results,c=b.concat([a]);this.setState({data:{results:c}}),$.ajax({url:this.props.url,dataType:"json",type:"POST",data:a,success:function(){this.loadCommentsFromServer()}.bind(this)})},getInitialState:function(){return{data:{results:[]}}},componentWillMount:function(){this.loadCommentsFromServer(),this.interval=setInterval(this.loadCommentsFromServer,this.props.pollInterval)},componentWillUnmount:function(){clearInterval(this.interval)},render:function(){return React.DOM.div({className:"commentBox"},CommentForm({onCommentSubmit:this.handleCommentSubmit}),CommentList({data:this.state.data.results}))}}),CommentForm=React.createClass({displayName:"CommentForm",handleSubmit:function(){var a=this.refs.text.getDOMNode().value.trim();return this.props.onCommentSubmit({comment:a,author_descr:get_user_name()}),this.refs.text.getDOMNode().value="",!1},render:function(){return React.DOM.form({className:"commentForm",onSubmit:this.handleSubmit},React.DOM.input({type:"text",placeholder:"Say something...",ref:"text"}),React.DOM.input({type:"submit",value:"Post"}))}}),CommentList=React.createClass({displayName:"CommentList",render:function(){var a=this.props.data.map(function(a){return Comment({key:a.id,author:a.author_descr},a.comment)});return React.DOM.div({className:"commentList"},a)}}),Comment=React.createClass({displayName:"Comment",render:function(){return React.DOM.div({className:"comment"},React.DOM.h2({className:"commentAuthor"},this.props.author),this.props.children.toString())}});!function(){"use strict";var a=React.createClass({displayName:"Task",render:function(){return this.transferPropsTo(React.DOM.li({className:this.props.selected?"active":"","data-url":this.props.data.url},React.DOM.h3(null,this.props.data.summary),React.DOM.span(null,this.props.data.description)))}}),b=React.createClass({displayName:"Revision",render:function(){return this.transferPropsTo(React.DOM.div(null,ProfilePic({user:this.props.data.revision.editor,username:this.props.data.revision.editor}),React.DOM.span(null,this.props.data.revision.editor),React.DOM.span(null,this.props.data.revision.date_created),React.DOM.div(null,this.props.data.revision.comment),React.DOM.div(null,React.DOM.h3(null,this.props.data.object.summary),React.DOM.span(null,this.props.data.object.description)),React.DOM.hr(null)))}}),c=React.createClass({displayName:"Follower",render:function(){return this.transferPropsTo(React.DOM.div(null,ProfilePic({user:this.props.data,username:this.props.data.username}),React.DOM.span(null,this.props.data.username)))}}),d=React.createClass({displayName:"FollowControl",propTypes:{is_following:React.PropTypes.bool.isRequired,object_url:React.PropTypes.string.isRequired,description:React.PropTypes.string.isRequired},getInitialState:function(){return{is_following:this.props.is_following}},onClick:function(a){var b=this.state.is_following?"DELETE":"POST";this.setState({is_following:!this.state.is_following}),a.preventDefault(),$.ajax({url:this.props.object_url+"follow/",dataType:"json",type:b,data:{},success:function(){}.bind(this)})},render:function(){var a=this.state.is_following?"Unfollow":"Follow",b=this.state.is_following?"fa fa-eye-slash":"fa fa-eye";return this.transferPropsTo(React.DOM.a({onClick:this.onClick,className:"followControl",href:"",title:a+" "+this.props.description},React.DOM.i({className:b})))}}),e=React.createClass({displayName:"ReadOnlyField",propTypes:{name:React.PropTypes.string.isRequired,value:React.PropTypes.string,url:React.PropTypes.string},render:function(){return this.transferPropsTo(React.DOM.div({className:"field"},React.DOM.div({className:"name"},this.props.name),React.DOM.div({className:"value"},React.DOM.a({href:this.props.url},this.props.value))))}}),f=React.createClass({displayName:"TaskDetail",getFields:function(){var a={},b=this;return $.map(this.props.data,function(c,d){if(d.match(/_descr$/)){var e=d.substring(0,d.length-"_descr".length);a[e]={},a[e].value=c,a[e].url=b.props.data[e]}},this),a},render:function(){return this.transferPropsTo(React.DOM.div({className:"taskDetail"},React.DOM.h3(null,this.props.data.summary),d({description:this.props.data.summary,object_url:this.props.data.url,is_following:this.props.data.is_following}),EditorControl({parent:this,object_url:this.props.data.url}),React.DOM.div(null,this.props.data.description),$.map(this.getFields(),function(a,b){return e({key:b,name:b,value:a.value,url:a.url})}.bind(this),this),TabsSwitcher({active:this.props.context[0],tabs:[{title:"Comments",content:CommentBox({url:this.props.data.url+"comments/",pollInterval:6e4})},{title:"Revisions",content:List({type:b,url:this.props.data.url+"revisions/",pathToId:"revision.revision_id"})},{title:"Followers",content:List({type:c,url:this.props.data.url+"followers/"})},{title:"Activity",content:NotificationStream({url:this.props.data.url+"activity/",pollInterval:6e4})}]})))}}),g=React.createClass({displayName:"Project",render:function(){return this.transferPropsTo(React.DOM.li({key:this.props.data.id,"data-url":this.props.data.url},React.DOM.h3(null,this.props.data.name),React.DOM.span(null,this.props.data.is_following)))}}),h=React.createClass({displayName:"ProjectDetail",render:function(){return console.log(this.props.data),this.transferPropsTo(React.DOM.div({className:"projectDetail"},React.DOM.h3(null,this.props.data.name),d({description:this.props.data.name,object_url:this.props.data.url,is_following:this.props.data.is_following}),"No further data at this point."))}});window.Dashboard=function(b){var c=b[0],d=b.slice(1);console.log("window.Dashboard: name "+c),console.log("window.Dashboard: state "+d),"tasks"==c?React.renderComponent(FilteredList({context:d,type:a,detailtype:f,url:window.get_user_url_promise("tasks/")}),$("#workspace-area")[0]):"projects"==c?React.renderComponent(FilteredList({context:d,type:g,detailtype:h,url:window.get_user_url_promise("projects/")}),$("#workspace-area")[0]):React.renderComponent(NotificationStream({url:"/users/1/activity/",pollInterval:5e3}),$("#workspace-area")[0])}}(),function(){"use strict";var a=!1,b={init:function(){var a=$(window).height()-$("#menu").height();$("body").css("height",a),$("#workspace").css("height",a)}};$(function(){$(window).on("resize",function(){b.init()}),b.init()});var c=function(b,c,d){return b?(a&&$("#workspace-menu > div").removeClass("active"),d||(d="index"),$("#workspace-menu > div."+c).addClass("active"),$("workspace-area > div."+c).addClass("active"),$("#workspace-menu > div."+c+" li").removeClass("active"),$("#workspace-menu > div."+c).find("li a[href='#!"+c+";"+d+"']").parent().addClass("active"),$("#menu li").removeClass("active"),$("#menu li a[href='#!"+c+"']").parent().addClass("active"),b(d),void(a=c)):(console.log("No view initiator found. Abort!"),!1)};$(window).on("hashchange",function(){var a=window.location.hash.substr(2).split(";")[0];c(window[a.charAt(0).toUpperCase()+a.slice(1)],a,window.location.hash.substr(2).split(";").slice(1))}),$(document).ready(function(){if(window.location.hash){var a=window.location.hash.substr(2).split(";")[0];c(window[a.charAt(0).toUpperCase()+a.slice(1)],a,window.location.hash.substr(2).split(";").slice(1))}else window.location.hash="!dashboard";window.renderUserMenu()})}();